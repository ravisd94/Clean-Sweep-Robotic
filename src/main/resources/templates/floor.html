<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Vacuum Cleaner - Log of Actions</title>
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css">
    <style>
        body {
            background-color: #f8f9fa;
        }
        h1 {
            text-align: center;
            margin-top: 20px;
        }
        .grid {
            max-width: 500px;
            margin: 20px auto;
        }
        .table {
            table-layout: fixed;
        }
        td {
            width: 60px;
            height: 60px;
            text-align: center;
            background-color: white;
            transition: background-color 0.3s;
        }
        .furniture {
            background-color: red;
            color: white;
        }
        .vacuum {
            background-color: blue;
            color: white;
        }
        .cleaned {
            background-color: green;
        }
        #startVacuumButton {
            display: block;
            margin: 20px auto;
        }
        #stopVacuumButton {
            display: block;
            margin: 10px auto;
            background-color: red;
            color: white;
        }
        #cleanedCount {
            text-align: center;
            margin-top: 20px;
            font-size: 20px;
            font-weight: bold;
        }
        #batteryLevel {
            text-align: center;
            margin-top: 10px;
            font-size: 18px;
            color: #555;
        }
        #logContainer {
            max-width: 500px;
            margin: 20px auto;
            background-color: #fff;
            padding: 10px;
            border: 1px solid #ddd;
            height: 200px;
            overflow-y: auto;
        }
        .log-entry {
            font-family: monospace;
            font-size: 14px;
            color: #333;
        }
    </style>
</head>
<body>
    <div class="container mt-4">
        <h1>Vacuum Cleaner - Log of Actions</h1>
        <button id="startVacuumButton" class="btn btn-primary">Start Vacuum</button>
        <button id="stopVacuumButton" class="btn btn-danger">Stop Vacuum</button>
        <div class="grid">
            <table class="table table-bordered">
                <tbody>
                    <tr>
                        <td class="furniture">Furniture</td>
                        <td></td>
                        <td></td>
                        <td class="furniture">Wall</td>
                        <td></td>
                    </tr>
                    <tr>
                        <td></td>
                        <td></td>
                        <td class="furniture">Furniture</td>
                        <td></td>
                        <td></td>
                    </tr>
                    <tr>
                        <td class="vacuum" id="vacuum"></td>
                        <td></td>
                        <td class="furniture">Staircase</td>
                        <td></td>
                        <td></td>
                    </tr>
                    <tr>
                        <td></td>
                        <td></td>
                        <td></td>
                        <td></td>
                        <td></td>
                    </tr>
                    <tr>
                        <td></td>
                        <td></td>
                        <td></td>
                        <td></td>
                        <td></td>
                    </tr>
                </tbody>
            </table>
        </div>
        <div id="cleanedCount">Cleaned Cells: 0</div>
        <div id="batteryLevel">Battery Level: 5%</div>
        <div id="logContainer">
            <div id="logEntries"></div>
        </div>
    </div>

    <script>
        let vacuumPosition = { row: 2, col: 0 }; // Initial vacuum position
        let directions = ['right', 'down', 'left', 'up']; // Movement direction priority
        let currentDirectionIndex = 0; // Starting by moving right
        let visitedCells = new Set(); // Keep track of visited cells
        let cleanedCellsCount = 0; // Track number of cleaned cells
        let vacuumMoving = false; // Track vacuum movement state
        let vacuumTimeout; // To store the timeout for the vacuum movement
        let batteryLevel = 5; // Start with 5% battery
        let cellsSinceLastDepletion = 0; // Track how many cells have been cleaned since last depletion

        // Log of actions
        let actionLog = [];

        // Starts vacuum when button is clicked
        document.getElementById('startVacuumButton').addEventListener('click', function() {
            if (!vacuumMoving && batteryLevel > 0) {
                vacuumMoving = true;
                moveVacuum();
            }
        });

        // Stops vacuum when button is clicked
        document.getElementById('stopVacuumButton').addEventListener('click', function() {
            vacuumMoving = false;
            clearTimeout(vacuumTimeout); // Stop the vacuum movement
            document.getElementById('vacuum').classList.remove('vacuum'); // Optionally, remove vacuum from the grid
        });

        // Function to log an action
        function logAction(message) {
            const logContainer = document.getElementById('logEntries');
            actionLog.push(message);
            const logEntry = document.createElement('div');
            logEntry.className = 'log-entry';
            logEntry.textContent = message;
            logContainer.appendChild(logEntry);
            logContainer.scrollTop = logContainer.scrollHeight; // Auto-scroll to the latest entry
        }

        // Function to get the next valid move for the vacuum
        function getNextMove(rows, direction, checkUncleaned = false) {
            const { row, col } = vacuumPosition;
            let nextRow = row;
            let nextCol = col;

            // Try moving in the current direction
            switch (direction) {
                case 'right': nextCol++; break;
                case 'down': nextRow++; break;
                case 'left': nextCol--; break;
                case 'up': nextRow--; break;
            }

            // If the move is valid, return the new position
            if (isValidMove(nextRow, nextCol, rows, checkUncleaned)) {
                return { row: nextRow, col: nextCol };
            }

            return null; // Invalid move
        }

        function isValidMove(row, col, rows, checkUncleaned = false) {
            if (row < 0 || col < 0 || row >= rows.length || col >= rows[0].children.length) return false;

            const cell = rows[row].children[col];

            // If checkUncleaned is true, only allow moving to uncleaned cells
            if (checkUncleaned) {
                return !cell.classList.contains('furniture') && !cell.classList.contains('cleaned');
            }

            return !cell.classList.contains('furniture'); // Only move to non-furniture cells if not checking for uncleaned
        }

        function moveVacuum() {
            if (!vacuumMoving || batteryLevel <= 0) return; // Stop if vacuum is not moving or battery is depleted

            const rows = document.querySelectorAll('tbody tr');
            const currentCell = rows[vacuumPosition.row].children[vacuumPosition.col];

            // Clean the current cell
            const cellIdentifier = `${vacuumPosition.row}-${vacuumPosition.col}`;
            if (!visitedCells.has(cellIdentifier)) {
                currentCell.classList.add('cleaned'); // Mark as cleaned
                visitedCells.add(cellIdentifier); // Mark cell as visited
                cleanedCellsCount++;
                document.getElementById('cleanedCount').textContent = `Cleaned Cells: ${cleanedCellsCount}`;

                // Log the cleaning action
                logAction(`Cleaned cell at [${vacuumPosition.row}, ${vacuumPosition.col}]`);

                // Track cleaned cells and reduce battery for every 2 cleaned cells
                cellsSinceLastDepletion++;
                if (cellsSinceLastDepletion >= 2) {
                    batteryLevel--;
                    cellsSinceLastDepletion = 0;
                }

                document.getElementById('batteryLevel').textContent = `Battery Level: ${batteryLevel}%`;

                // Log battery status
                logAction(`Battery level decreased to ${batteryLevel}%`);

                if (batteryLevel === 0) {
                    alert('Battery depleted. Please recharge.');
                    logAction("Battery depleted. Please recharge.");
                    vacuumMoving = false;
                    return;
                }
            }

            currentCell.classList.remove('vacuum'); // Remove vacuum from the current cell

            // Find the next move
            let possibleMoves = [];
            for (let i = 0; i < directions.length; i++) {
                const direction = directions[(currentDirectionIndex + i) % directions.length];
                const nextMove = getNextMove(rows, direction, true); // Check for uncleaned cells first
                if (nextMove) {
                    possibleMoves.push(nextMove);
                }
            }

            // Move to the next valid cell or stop if no valid moves
            if (possibleMoves.length > 0) {
                vacuumPosition = possibleMoves[0]; // Move to the first valid position
                currentDirectionIndex = (currentDirectionIndex + 1) % directions.length; // Update direction
                rows[vacuumPosition.row].children[vacuumPosition.col].classList.add('vacuum');
            } else {
                vacuumMoving = false; // Stop moving if no valid moves are available
                logAction("No valid moves left. Vacuum stopped.");
            }

            // Continue moving after a delay
            vacuumTimeout = setTimeout(moveVacuum, 500); // Adjust delay for realistic speed
        }
    </script>
</body>
</html>

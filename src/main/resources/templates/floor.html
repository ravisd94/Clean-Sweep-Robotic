<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Vacuum Cleaner - Log of Actions</title>
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css">
    <style>
        body {
            background-color: #f8f9fa;
        }
        h1 {
            text-align: center;
            margin-top: 20px;
        }
        .grid {
            max-width: 500px;
            margin: 20px auto;
        }
        .table {
            table-layout: fixed;
        }
        td {
            width: 60px;
            height: 60px;
            text-align: center;
            background-color: white;
            transition: background-color 0.3s;
        }
        .furniture {
            background-color: red;
            color: white;
        }
        .vacuum {
            background-color: blue;
            color: white;
        }
        .cleaned {
            background-color: green;
        }
        #startVacuumButton {
            display: block;
            margin: 20px auto;
        }
        #stopVacuumButton {
            display: block;
            margin: 10px auto;
            background-color: red;
            color: white;
        }
        #cleanedCount {
            text-align: center;
            margin-top: 20px;
            font-size: 20px;
            font-weight: bold;
        }
        #logContainer {
            max-width: 500px;
            margin: 20px auto;
            background-color: #fff;
            padding: 10px;
            border: 1px solid #ddd;
            height: 200px;
            overflow-y: auto;
        }
        .log-entry {
            font-family: monospace;
            font-size: 14px;
            color: #333;
        }
    </style>
</head>
<body>
    <div class="container mt-4">
        <h1>Vacuum Cleaner - Log of Actions</h1>
        <button id="startVacuumButton" class="btn btn-primary">Start Vacuum</button>
        <button id="stopVacuumButton" class="btn btn-danger">Stop Vacuum</button>
        <div class="grid">
            <table class="table table-bordered">
                <tbody>
                    <tr>
                        <td class="furniture">Furniture</td>
                        <td></td>
                        <td></td>
                        <td class="furniture">Wall</td>
                        <td></td>
                    </tr>
                    <tr>
                        <td></td>
                        <td></td>
                        <td class="furniture">Furniture</td>
                        <td></td>
                        <td></td>
                    </tr>
                    <tr>
                        <td class="vacuum" id="vacuum"></td>
                        <td></td>
                        <td class="furniture">Staircase</td>
                        <td></td>
                        <td></td>
                    </tr>
                    <tr>
                        <td></td>
                        <td></td>
                        <td></td>
                        <td></td>
                        <td></td>
                    </tr>
                    <tr>
                        <td></td>
                        <td></td>
                        <td></td>
                        <td></td>
                        <td></td>
                    </tr>
                </tbody>
            </table>
        </div>
        <div id="cleanedCount">Cleaned Cells: 0</div>
        <div id="logContainer">
            <div id="logEntries"></div>
        </div>
    </div>

    <script>
        let vacuumPosition = { row: 2, col: 0 }; // Initial vacuum position
        let directions = ['right', 'down', 'left', 'up']; // Movement direction priority
        let currentDirectionIndex = 0; // Starting by moving right
        let visitedCells = new Set(); // Keep track of visited cells
        let cleanedCellsCount = 0; // Track number of cleaned cells
        let vacuumMoving = false; // Track vacuum movement state
        let vacuumTimeout; // To store the timeout for the vacuum movement

        // Object to track how many times each cell is cleaned
        let cellCleanCounts = {};

        // Log of actions
        let actionLog = [];

        // Starts vacuum when button is clicked
        document.getElementById('startVacuumButton').addEventListener('click', function() {
            if (!vacuumMoving) {
                vacuumMoving = true;
                moveVacuum();
            }
        });

        // Stops vacuum when button is clicked
        document.getElementById('stopVacuumButton').addEventListener('click', function() {
            vacuumMoving = false;
            clearTimeout(vacuumTimeout); // Stop the vacuum movement
            document.getElementById('vacuum').classList.remove('vacuum'); // Optionally, remove vacuum from the grid
        });

        // Initialize the grid (get total number of cells)
        function initializeGrid() {
            const rows = document.querySelectorAll('tbody tr');
        }

        // Function to log an action
        function logAction(message) {
            const logContainer = document.getElementById('logEntries');
            actionLog.push(message);
            const logEntry = document.createElement('div');
            logEntry.className = 'log-entry';
            logEntry.textContent = message;
            logContainer.appendChild(logEntry);
            logContainer.scrollTop = logContainer.scrollHeight; // Auto-scroll to the latest entry
        }

        // Function to get the next valid move for the vacuum
        function getNextMove(rows, direction, checkUncleaned = false) {
            const { row, col } = vacuumPosition;
            let nextRow = row;
            let nextCol = col;

            // Try moving in the current direction
            switch (direction) {
                case 'right': nextCol++; break;
                case 'down': nextRow++; break;
                case 'left': nextCol--; break;
                case 'up': nextRow--; break;
            }

            // If the move is valid, return the new position
            if (isValidMove(nextRow, nextCol, rows, checkUncleaned)) {
                return { row: nextRow, col: nextCol };
            }

            return null; // Invalid move
        }

        function isValidMove(row, col, rows, checkUncleaned = false) {
            if (row < 0 || col < 0 || row >= rows.length || col >= rows[0].children.length) return false;

            const cell = rows[row].children[col];

            // If checkUncleaned is true, only allow moving to uncleaned cells
            if (checkUncleaned) {
                return !cell.classList.contains('furniture') && !cell.classList.contains('cleaned');
            }

            return !cell.classList.contains('furniture'); // Only move to non-furniture cells if not checking for uncleaned
        }

        function moveVacuum() {
            if (!vacuumMoving) return; // Stop if vacuum is not moving

            const rows = document.querySelectorAll('tbody tr');
            const currentCell = rows[vacuumPosition.row].children[vacuumPosition.col];

            // Clean the current cell
            const cellIdentifier = `${vacuumPosition.row}-${vacuumPosition.col}`;
            if (!visitedCells.has(cellIdentifier)) {
                currentCell.classList.add('cleaned'); // Mark as cleaned
                visitedCells.add(cellIdentifier); // Mark cell as visited
                cleanedCellsCount++;
                document.getElementById('cleanedCount').textContent = `Cleaned Cells: ${cleanedCellsCount}`;

                // Increase the count for this cell
                if (!cellCleanCounts[cellIdentifier]) {
                    cellCleanCounts[cellIdentifier] = 1;
                } else {
                    cellCleanCounts[cellIdentifier]++;
                }

                // Log the cleaning action
                logAction(`Cleaned cell at [${vacuumPosition.row}, ${vacuumPosition.col}] - Cleaned ${cellCleanCounts[cellIdentifier]} time(s)`);

                // If this cell is cleaned 5 times, stop
                if (cellCleanCounts[cellIdentifier] > 5) {
                    logAction(`Cell [${vacuumPosition.row}, ${vacuumPosition.col}] cleaned 5 times. Vacuum stopped.`);
                    vacuumMoving = false;
                    clearTimeout(vacuumTimeout);
                    return;
                }
            }

            currentCell.classList.remove('vacuum'); // Remove vacuum from the current cell

            // First, prioritize uncleaned cells
            let possibleMoves = [];
            for (let i = 0; i < directions.length; i++) {
                const direction = directions[(currentDirectionIndex + i) % directions.length];
                const nextMove = getNextMove(rows, direction, true); // Check for uncleaned cells first
                if (nextMove) {
                    possibleMoves.push({ move: nextMove, directionIndex: (currentDirectionIndex + i) % directions.length });
                }
            }

            if (possibleMoves.length === 0) {
                // If no uncleaned cells, look for any valid move
                for (let i = 0; i < directions.length; i++) {
                    const direction = directions[(currentDirectionIndex + i) % directions.length];
                    const nextMove = getNextMove(rows, direction);
                    if (nextMove) {
                        possibleMoves.push({ move: nextMove, directionIndex: (currentDirectionIndex + i) % directions.length });
                    }
                }
            }

            if (possibleMoves.length === 0) {
                logAction('No possible moves left. Vacuum stopped.');
                vacuumMoving = false;
                return;
            }

            // Pick the first valid move and move the vacuum
            const chosenMove = possibleMoves[0];

            // Move the vacuum to the new position
            vacuumPosition = chosenMove.move;
            currentDirectionIndex = chosenMove.directionIndex;
            const nextCell = rows[vacuumPosition.row].children[vacuumPosition.col];
            nextCell.classList.add('vacuum'); // Mark the new position as the vacuum cleaner

            // Log the movement action
            logAction(`Moving vacuum to [${vacuumPosition.row}, ${vacuumPosition.col}] - Direction: ${directions[currentDirectionIndex]}`);

            // Continue moving the vacuum after a delay
            vacuumTimeout = setTimeout(moveVacuum, 1000); // Adjust speed with delay
        }

        // Initialize grid and vacuum cleaner position
        initializeGrid();
    </script>
</body>
</html>
